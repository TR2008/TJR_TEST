<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>HVACSolution81</title>
    <style>
        /* Base e Fundo */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f4f4f4; /* Cor de fallback */
            background-image: url('{{ url_for('static', filename='images/TJRArcondicionado.png') }}');
            background-size: cover; /* valor inicial, será ajustável */
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            transition: background-size 200ms ease;
            position: relative;
        }

        /* Controlo de ajuste do fundo (UI) */
        .bg-control {
            position: fixed;
            left: 16px;
            bottom: 16px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            font-size: 14px;
            color: #222;
            max-width: 320px;
        }
        .bg-control label { display: block; margin-bottom: 6px; font-weight: 600; }
        .bg-control .row { display:flex; gap:8px; align-items:center; }
        .bg-control input[type="range"] { flex:1; }
        .bg-control select, .bg-control input[type="number"] {
            width: 90px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
        }
        .bg-control .small { font-size:12px; color:#555; margin-top:6px; }

        .cabecalho {
            background-color:#FF4500;
            color: white;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .header-flex { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); max-width: 1200px; margin: 0 auto; }
        .logo { font-size: 36px; font-weight: bold; letter-spacing: 2px; }
        .nav-links a { color: white; text-decoration: none; font-size: 18px; margin-left: 25px; transition: color 0.3s; }
        .nav-links a:hover { color: #ffd700; }
        .subtitulo { font-size: 18px; font-weight: normal; margin-top: 10px; color: #cce6ff; text-align: center; }

        main { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 40px 20px; }
        .content-container { display: flex; gap: 40px; align-items: center; max-width: 900px; width: 100%; }
        .form-container { background-color: rgba(255,255,255,0.95); padding: 30px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.1); width: 300px; flex-shrink: 0; }
        .image-box { flex-grow: 1; text-align: right; }
        .image-box img { max-width: 100%; height: auto; border-radius: 8px; }
        h2 { text-align: center; margin-bottom: 20px; color: #003366; }
        .form-control { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .btn-primary { width:100%; padding:12px; color:white; border:none; border-radius:4px; background:#28a745; cursor:pointer; }
        .btn-secondary { width:100%; padding:12px; color:white; border:none; border-radius:4px; background:#004d99; cursor:pointer; margin-top:10px; }
        @media (max-width: 768px) { .content-container { flex-direction: column; gap: 20px; } .image-box { text-align: center; } .bg-control { left: 50%; transform: translateX(-50%); } }
    </style>
</head>
<body>
<header class="cabecalho">
    <div class="header-flex">
        <div class="logo">HVACsolution81</div>
        <nav class="nav-links">
            <a href="{{ url_for('paginas.produtos_html') }}">Produtos</a>
            <a href="{{ url_for('paginas.servicos_html') }}">Serviços</a>
            <a href="{{ url_for('paginas.contactos') }}">Contactos</a>
            <a id="nav-register" style="cursor:pointer">Registar</a>
            <a href="{{ url_for('auth.logout') }}">Sair</a>
        </nav>
    </div>
    <p class="subtitulo">Instaladores de A.C., Assistência Técnica, Ventilação, Bombas de Calor, Free Cooling — pensamos sempre no seu conforto</p>
</header>

<main>
    <div class="content-container">
        <div class="form-container">
            <div id="login-form">
                <h2>Login</h2>
                <form method="POST" action="{{ url_for('auth.login') }}">
                    {% if form is defined %}
                        {{ form.hidden_tag() }}
                        {{ form.email(class="form-control", placeholder="seu@exemplo.com") }}
                        {{ form.senha(class="form-control", placeholder="Password") }}
                        {{ form.submit(class="btn-primary") }}
                    {% else %}
                        <input type="email" name="email" class="form-control" placeholder="seu@exemplo.com" required>
                        <input type="password" name="senha" class="form-control" placeholder="Password" required>
                        <button type="submit" class="btn-primary">Entrar</button>
                    {% endif %}
                </form>
            </div>

            <div id="register-form" style="display:none; margin-top:12px;">
                <h2>Registar</h2>
                <form id="registerForm" method="POST" action="{{ url_for('auth.register') }}">
                    {% if reg_form is defined %}
                        {{ reg_form.hidden_tag() }}
                        {{ reg_form.nome(class="form-control", placeholder="Nome") }}
                        {{ reg_form.email(class="form-control", placeholder="seu@exemplo.com") }}
                        {{ reg_form.senha(class="form-control", placeholder="Password") }}
                        {{ reg_form.senha2(class="form-control", placeholder="Confirmar Password") }}
                        {{ reg_form.submit(class="btn-primary") }}
                    {% else %}
                        <input id="reg-nome" name="nome" type="text" class="form-control" placeholder="Nome" required>
                        <input id="reg-email" name="email" type="email" class="form-control" placeholder="seu@exemplo.com" required>
                        <input id="reg-password" name="senha" type="password" class="form-control" placeholder="Password" required>
                        <input id="reg-password2" name="senha2" type="password" class="form-control" placeholder="Confirmar Password" required>
                        <input id="reg-submit" type="submit" class="btn-primary" value="Registar">
                    {% endif %}
                </form>
            </div>

            <button id="toggle-form-btn" type="button" class="btn-secondary">Criar Novo Utilizador</button>
            {% if mensagem %}
              <p class="mensagem" style="margin-top:10px;color:darkred;">{{ mensagem }}</p>
            {% endif %}
        </div>

        <div class="image-box">
            <!-- Espaço para imagens se necessário -->
        </div>
    </div>
</main>

<!-- Controlo de background -->
<div class="bg-control" id="bgControl" aria-label="Controlos do background">
    <label for="bgMode">Tamanho do background</label>
    <div class="row" style="margin-bottom:6px;">
        <select id="bgMode" title="Modo">
            <option value="cover">cover</option>
            <option value="contain">contain</option>
            <option value="percent">percent (personalizado)</option>
        </select>
        <input id="bgPercent" type="number" min="10" max="500" value="100" title="Porcentagem" style="display:none">%
    </div>
    <div class="row">
        <input id="bgRange" type="range" min="10" max="500" value="100" step="1" title="Ajustar tamanho">
        <div id="bgValue" style="width:46px; text-align:right;">100%</div>
    </div>
    <div class="small">Modo: cover/contain ou percent (100% = tamanho original em largura). Preferência guardada.</div>
</div>

<script>
    // DOM refs
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const toggleButton = document.getElementById('toggle-form-btn');
    const navRegister = document.getElementById('nav-register');
    const registerHTMLForm = document.getElementById('registerForm');

    // Background control refs
    const bgMode = document.getElementById('bgMode');
    const bgRange = document.getElementById('bgRange');
    const bgValue = document.getElementById('bgValue');
    const bgPercent = document.getElementById('bgPercent');

    function showRegister() {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        toggleButton.textContent = 'Iniciar Registo';
        const firstInput = registerForm.querySelector('input, textarea, select');
        if (firstInput) firstInput.focus();
    }
    function showLogin() {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        toggleButton.textContent = 'Criar Novo Utilizador';
        const firstInput = loginForm.querySelector('input, textarea, select');
        if (firstInput) firstInput.focus();
    }

    toggleButton.addEventListener('click', function() {
        if (registerForm.style.display === 'block') {
            if (registerHTMLForm) {
                registerHTMLForm.submit();
            } else {
                showLogin();
            }
        } else {
            showRegister();
        }
    });

    navRegister.addEventListener('click', function() {
        if (registerForm.style.display === 'block') {
            showLogin();
        } else {
            showRegister();
        }
    });

    // Background size logic
    function applyBackgroundSize(mode, percent) {
        if (mode === 'cover' || mode === 'contain') {
            document.body.style.backgroundSize = mode;
            bgRange.disabled = true;
            bgValue.textContent = mode;
        } else {
            // percent mode: set width percent auto height (ex: "120% auto")
            const pct = parseInt(percent, 10) || 100;
            document.body.style.backgroundSize = pct + '% auto';
            bgRange.disabled = false;
            bgValue.textContent = pct + '%';
        }
    }

    // Load saved preferences
    const savedMode = localStorage.getItem('bg_mode') || 'cover';
    const savedPct = localStorage.getItem('bg_percent') || '100';
    bgMode.value = savedMode;
    bgRange.value = savedPct;
    bgPercent.value = savedPct;

    // Initialize UI based on mode
    function updateUIFromMode() {
        if (bgMode.value === 'percent') {
            bgPercent.style.display = 'inline-block';
            bgPercent.value = bgRange.value;
        } else {
            bgPercent.style.display = 'none';
        }
    }
    updateUIFromMode();
    applyBackgroundSize(bgMode.value, bgRange.value);

    // Event listeners
    bgMode.addEventListener('change', function() {
        localStorage.setItem('bg_mode', bgMode.value);
        updateUIFromMode();
        applyBackgroundSize(bgMode.value, bgRange.value);
    });

    bgRange.addEventListener('input', function() {
        bgPercent.value = bgRange.value;
        localStorage.setItem('bg_percent', bgRange.value);
        if (bgMode.value === 'percent') {
            applyBackgroundSize('percent', bgRange.value);
        } else {
            bgValue.textContent = bgRange.value + '%';
        }
    });

    bgPercent.addEventListener('change', function() {
        let v = parseInt(bgPercent.value, 10);
        if (isNaN(v) || v < 10) v = 10;
        if (v > 500) v = 500;
        bgPercent.value = v;
        bgRange.value = v;
        localStorage.setItem('bg_percent', v);
        applyBackgroundSize('percent', v);
    });

    // Start with login visible
    showLogin();
</script>

</body>
</html>